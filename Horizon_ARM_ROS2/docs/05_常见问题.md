# 05 常见问题（FAQ）

## 🛠️ 硬件连接问题

### Q: SLCAN连接失败或通信超时？
**A**: 排查步骤：
1. 检查串口权限：`sudo usermod -a -G dialout $USER`
2. 检查设备连接：`ls -l /dev/ttyACM*`
3. 检查线缆和接线质量
4. 确认没有其他程序占用串口
5. 必要时重插USB设备或重启系统

### Q: 如何确认正在使用wheel安装的SDK？
**A**: 运行以下验证代码：
```python
import simple_sdk, inspect
from Control_Core.motor_controller_modular import ZDTMotorControllerModular
print('simple_sdk path =', inspect.getsourcefile(simple_sdk))
print('Control_Core path =', ZDTMotorControllerModular.__module__)
```
路径包含 `site-packages` 即为正确安装。

## 📱 UI控制问题

### Q: 实时模式下UI电机参数显示为NaN？
**A**: 这是正常的"软避让"机制。当外部脚本占用串口进行实时控制时，UI暂停状态读取以避免冲突。脚本结束后会自动恢复。

### Q: UI连接机械臂后RViz仍显示旧位置？
**A**: UI不发布joint_states，需要等待驱动节点的状态同步。这是设计机制，确保状态发布的一致性。

### Q: UI连接后立即断开？
**A**: 检查以下项目：
- 电机ID配置是否与实际硬件一致
- 波特率配置是否正确（默认500000）
- 硬件上电状态和电源连接

## 🚀 实时控制问题

### Q: 实时模式下机械臂“来回调”？
**A**: 调优参数解决：
```yaml
# 在 mapping.yaml 中调整
stream_settle_tol_deg: 1.0        # 增大容差
stream_settle_hold_iters: 8       # 增加稳定次数  
stream_finalize_with_abs: true    # 开启精确定位
servo_rate_hz: 30                 # 降低频率
```

### Q: 实时跟随速度过快或过慢？
**A**: 调整相关参数：
- 过快：降低 `vel_limit_deg_s` 数组值
- 过慢：增大 `stream_speed_rpm` 或 `max_speed_rpm`
- 检查 `gear_ratio` 配置是否正确

## 🌀 ROS2和RViz问题

### Q: RViz中机械臂模型不显示或显示异常？
**A**: 检查以下项目：
1. 确认ROS2环境正确加载：`source install/setup.bash`
2. 检查 `/joint_states` 话题发布：`ros2 topic echo /joint_states`
3. 检查URDF模型加载：`ros2 param get /robot_state_publisher robot_description`
4. 重新加载 RViz 配置文件

### Q: RViz执行"Plan & Execute"后机械臂不动？
**A**: 系统支持虚拟执行演示：
- RViz中的"Plan & Execute"可以在虚拟环境中演示轨迹
- 实际硬件控制请使用UI界面的控制按钮
- 或使用实时话题`/horizon_arm/servo_target`进行编程控制

### Q: MoveIt规划太慢或使用CHOMP？
**A**: 系统已配置优先使用OMPL规划器：
- 如果仍显示CHOMP，请检查启动是否完整
- 重建项目：`colcon build --symlink-install`
- 确认使用一键启动命令

### Q: RViz显示是否稳定？
**A**: 系统采用统一的状态发布机制，由驱动节点独家发布`/joint_states`，确保RViz显示的稳定性和一致性。

## 📊 性能优化

### Q: 如何提高系统响应速度？
**A**: 优化建议：
1. 增大 `servo_rate_hz` 至 100-200
2. 减小 `stream_min_delta_deg` 至 0.01
3. 开启 `stream_use_direct: true`
4. 适当增大 `vel_limit_deg_s`

### Q: 如何提高系统稳定性？
**A**: 稳定性优先配置：
1. 降低 `servo_rate_hz` 至 20-30
2. 增大 `stream_settle_hold_iters` 至 8-10
3. 开启 `stream_finalize_with_abs: true`
4. 适当增大 `stream_settle_tol_deg`

## 🐳 Docker相关问题

### Q: Docker容器无法访问串口设备？
**A**: 确保使用正确的设备映射：
```bash
docker run --device /dev/ttyACM0:/dev/ttyACM0 ...
```
或使用我们提供的脚本：
```bash
bash packaging/make_docker.sh run
```

### Q: Docker容器中GUI界面无法显示？
**A**: 配置X11转发：
```bash
# 允许X11连接
xhost +local:docker

# 运行时添加显示参数
docker run -e DISPLAY=$DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix ...
```

---

> 📞 **其他问题**: 如遇到未列出的问题，请检查系统日志或参考其他文档章节。大部分问题都可以通过正确配置和参数调优解决。
